name: Fix Firewall for SSH

on:
  workflow_dispatch:

jobs:
  fix-firewall:
    name: Fix UFW Rules
    runs-on: ubuntu-latest

    steps:
      - name: Fix UFW and Allow SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: ${{ secrets.SERVER_PORT || 22 }}
          script: |
            echo "=== Current UFW status ==="
            ufw status verbose

            echo ""
            echo "=== Allowing SSH (port 22) ==="
            ufw allow 22/tcp

            echo ""
            echo "=== Allowing port 3000 ==="
            ufw allow 3000/tcp

            echo ""
            echo "=== Final UFW status ==="
            ufw status verbose

            echo ""
            echo "=== Testing SSH access ==="
            echo "SSH connection successful!"
